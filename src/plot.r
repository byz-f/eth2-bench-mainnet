library(scales)
library(zoo)

lh = read.csv("../dat/light.csv", header = TRUE)
pr = read.csv("../dat/prysm.csv", header = TRUE)
tk = read.csv("../dat/teku.csv", header = TRUE)
nb = read.csv("../dat/nimbus.csv", header = TRUE)

col_lh = c("#9e0142", "#d53e4f", "#f46d43")
col_tk = c("#003c30", "#01665e", "#35978f")
col_pr = c("#40004b", "#762a83", "#9970ab")
col_nb = c("#053061", "#2166ac", "#4393c3")

pairs(lh[,c(8, 4, 7, 2, 3, 6)], main="Lighthouse", pch=".", col=alpha(col_lh[3], 0.3))
pairs(pr[,c(8, 4, 7, 2, 3, 6)], main="Prysm", pch=".", col=alpha(col_pr[3], 0.3))
pairs(tk[,c(8, 4, 7, 2, 3, 6)], main="Teku", pch=".", col=alpha(col_tk[3], 0.3))
pairs(nb[,c(8, 4, 7, 2, 3, 6)], main="Nimbus", pch=".", col=alpha(col_nb[3], 0.3))

sync <- plot(lh$time, lh$slot, main="Synchronization Progress", xlab="Time [s]", ylab="Slot [1]", pch=".", ylim=c(0, 130000), col=alpha(col_lh[3], 0.3))
sync <- lines(pr$time, pr$slot, type="p", pch=".", col=alpha(col_pr[3], 0.3))
sync <- lines(tk$time, tk$slot, type="p", pch=".", col=alpha(col_tk[3], 0.3))
sync <- lines(nb$time, nb$slot, type="p", pch=".", col=alpha(col_nb[3], 0.3))
sync <- lines(lh$time, rollmean(lh$slot, 600, fill=list(NA, NULL, NA)), col=alpha(col_lh[2], 0.5))
sync <- lines(pr$time, rollmean(pr$slot, 600, fill=list(NA, NULL, NA)), col=alpha(col_pr[2], 0.5))
sync <- lines(tk$time, rollmean(tk$slot, 600, fill=list(NA, NULL, NA)), col=alpha(col_tk[2], 0.5))
sync <- lines(nb$time, rollmean(nb$slot, 600, fill=list(NA, NULL, NA)), col=alpha(col_nb[2], 0.5))
sync <- text(-1000, 129000, "24min 55sec", cex=0.8, pos=4, col=col_lh[1])
sync <- text(500, 125000, "25min 35sec", cex=0.8, pos=4, col=col_pr[1])
sync <- text(4800, 119000, "1h 26min", cex=0.8, pos=4, col=col_tk[1])
sync <- text(24500, 121000, "6h 54min", cex=0.8, pos=4, col=col_nb[1])
sync <- text(22500, 20000, "--- Lighthouse", cex=0.8, pos=4, col=col_lh[1])
sync <- text(22500, 16000, "--- Prysm", cex=0.8, pos=4, col=col_pr[1])
sync <- text(22500, 12000, "--- Teku", cex=0.8, pos=4, col=col_tk[1])
sync <- text(22500, 8000, "--- Nimbus", cex=0.8, pos=4, col=col_nb[1])

dbt <- plot(pr$time, pr$db, main="Database Size", xlab="Time [s]", ylab="Database Size [B]", log="y", ylim=c(10000000,5000000000), pch=".", col=alpha(col_pr[3], 0.3))
dbt <- lines(tk$time, tk$db, type="p", pch=".", col=alpha(col_tk[3], 0.3))
dbt <- lines(lh$time, lh$db, type="p", pch=".", col=alpha(col_lh[3], 0.3))
dbt <- lines(nb$time, nb$db, type="p", pch=".", col=alpha(col_nb[3], 0.3))
dbt <- lines(lh$time, rollmean(lh$db, 600, fill=list(NA, NULL, NA)), col=alpha(col_lh[2], 0.5))
dbt <- lines(pr$time, rollmean(pr$db, 600, fill=list(NA, NULL, NA)), col=alpha(col_pr[2], 0.5))
dbt <- lines(tk$time, rollmean(tk$db, 600, fill=list(NA, NULL, NA)), col=alpha(col_tk[2], 0.5))
dbt <- lines(nb$time, rollmean(nb$db, 600, fill=list(NA, NULL, NA)), col=alpha(col_nb[2], 0.5))
dbt <- text(0, 5000000000, "--- Nimbus", cex=0.8, pos=4, col=col_nb[2])
dbt <- text(0, 4000000000, "--- Lighthouse", cex=0.8, pos=4, col=col_lh[2])
dbt <- text(0, 3200000000, "--- Prysm", cex=0.8, pos=4, col=col_pr[2])
dbt <- text(0, 2550000000, "--- Teku", cex=0.8, pos=4, col=col_tk[2])

mem <- plot(pr$time, pr$mem, main="Resident Memory", xlab="Time [s]", ylab="Memory Usage [B]", log="y", ylim=c(100000000,10000000000), pch=".", col=alpha(col_pr[3], 0.3))
mem <- lines(tk$time, tk$mem, type="p", pch=".", col=alpha(col_tk[3], 0.3))
mem <- lines(lh$time, lh$mem, type="p", pch=".", col=alpha(col_lh[3], 0.3))
mem <- lines(nb$time, nb$mem, type="p", pch=".", col=alpha(col_nb[3], 0.3))
mem <- lines(lh$time, rollmean(lh$mem, 600, fill=list(NA, NULL, NA)), col=alpha(col_lh[2], 0.5))
mem <- lines(pr$time, rollmean(pr$mem, 600, fill=list(NA, NULL, NA)), col=alpha(col_pr[2], 0.5))
mem <- lines(tk$time, rollmean(tk$mem, 600, fill=list(NA, NULL, NA)), col=alpha(col_tk[2], 0.5))
mem <- lines(nb$time, rollmean(nb$mem, 600, fill=list(NA, NULL, NA)), col=alpha(col_nb[2], 0.5))
mem <- text(22500, 200000000, "--- Teku", cex=0.8, pos=4, col=col_tk[2])
mem <- text(22500, 176000000, "--- Prysm", cex=0.8, pos=4, col=col_pr[2])
mem <- text(22500, 154000000, "--- Lighthouse", cex=0.8, pos=4, col=col_lh[2])
mem <- text(22500, 134000000, "--- Nimbus", cex=0.8, pos=4, col=col_nb[2])

prs <- plot(lh$time, lh$peers, main="P2P Peer Count", xlab="Time [s]", ylab="Peer Count [1]", pch=".", col=alpha(col_lh[3], 0.3))
prs <- lines(pr$time, pr$peers, type="p", pch=".", col=alpha(col_pr[3], 0.3))
prs <- lines(tk$time, tk$peers, type="p", pch=".", col=alpha(col_tk[3], 0.3))
prs <- lines(nb$time, nb$peers, type="p", pch=".", col=alpha(col_nb[3], 0.3))
prs <- lines(lh$time, rollmean(lh$peers, 600, fill=list(NA, NULL, NA)), col=alpha(col_lh[2], 0.5))
prs <- lines(pr$time, rollmean(pr$peers, 600, fill=list(NA, NULL, NA)), col=alpha(col_pr[2], 0.5))
prs <- lines(tk$time, rollmean(tk$peers, 600, fill=list(NA, NULL, NA)), col=alpha(col_tk[2], 0.5))
prs <- lines(nb$time, rollmean(nb$peers, 600, fill=list(NA, NULL, NA)), col=alpha(col_nb[2], 0.5))
prs <- text(0, 96, "--- Lighthouse", cex=0.8, pos=4, col=col_lh[2])
prs <- text(0, 93, "--- Teku", cex=0.8, pos=4, col=col_tk[2])
prs <- text(0, 90, "--- Prysm", cex=0.8, pos=4, col=col_pr[2])
prs <- text(0, 87, "--- Nimbus", cex=0.8, pos=4, col=col_nb[2])

bps <- plot(lh$time, lh$bps_avg, main="Synchronization Speed", xlab="Time [s]", ylab="Slots per Second [1/s]", log="y", ylim=c(1, 150), pch=".", col=alpha(col_lh[3], 0.3))
bps <- lines(pr$time, pr$bps_avg, type="p", pch=".", col=alpha(col_pr[3], 0.3))
bps <- lines(tk$time, tk$bps_avg, type="p", pch=".", col=alpha(col_tk[3], 0.3))
bps <- lines(nb$time, nb$bps_avg, type="p", pch=".", col=alpha(col_nb[3], 0.3))
bps <- lines(lh$time, rollmean(lh$bps_avg, 600, fill=list(NA, NULL, NA)), col=alpha(col_lh[2], 0.5))
bps <- lines(pr$time, rollmean(pr$bps_avg, 600, fill=list(NA, NULL, NA)), col=alpha(col_pr[2], 0.5))
bps <- lines(tk$time, rollmean(tk$bps_avg, 600, fill=list(NA, NULL, NA)), col=alpha(col_tk[2], 0.5))
bps <- lines(nb$time, rollmean(nb$bps_avg, 600, fill=list(NA, NULL, NA)), col=alpha(col_nb[2], 0.5))
bps <- text(1500, 86, "81.676/s", cex=0.8, pos=4, col=col_lh[1])
bps <- text(1600, 75, "79.524/s", cex=0.8, pos=4, col=col_pr[1])
bps <- text(5200, 24, "23.659/s", cex=0.8, pos=4, col=col_tk[1])
bps <- text(24900, 5, "4.9932/s", cex=0.8, pos=4, col=col_nb[1])
bps <- text(22500, 101, "--- Lighthouse", cex=0.8, pos=4, col=col_lh[1])
bps <- text(22500, 86, "--- Prysm", cex=0.8, pos=4, col=col_pr[1])
bps <- text(22500, 74, "--- Teku", cex=0.8, pos=4, col=col_tk[1])
bps <- text(22500, 64, "--- Nimbus", cex=0.8, pos=4, col=col_nb[1])
