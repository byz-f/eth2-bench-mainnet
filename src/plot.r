library(scales)
library(zoo)

lh = read.csv("../dat/light.csv", header = TRUE)
pr = read.csv("../dat/prysm.csv", header = TRUE)
tk = read.csv("../dat/teku.csv", header = TRUE)
oe = read.csv("../dat/parity.csv", header = TRUE)

col_lh = c("#9e0142", "#d53e4f", "#f46d43")
col_tk = c("#003c30", "#01665e", "#35978f")
col_pr = c("#40004b", "#762a83", "#9970ab")
col_oe = c("#1a1a1a", "#4d4d4d", "#878787")

pairs(lh[,c(8, 4, 7, 2, 3, 6)], main="Lighthouse", pch=".", col=alpha(col_lh[3], 0.3))
pairs(pr[,c(8, 4, 7, 2, 3, 6)], main="Prysm", pch=".", col=alpha(col_pr[3], 0.3))
pairs(tk[,c(8, 4, 7, 2, 3, 6)], main="Teku", pch=".", col=alpha(col_tk[3], 0.3))

sync <- plot(lh$time, lh$slot, main="Synchronization Progress", xlab="Time [s]", ylab="Slot [1]", pch=".", col=alpha(col_lh[3], 0.3))
sync <- lines(pr$time, pr$slot, type="p", pch=".", col=alpha(col_pr[3], 0.3))
sync <- lines(tk$time, tk$slot, type="p", pch=".", col=alpha(col_tk[3], 0.3))
sync <- lines(lh$time, rollmean(lh$slot, 600, fill=list(NA, NULL, NA)), col=alpha(col_lh[2], 0.5))
sync <- lines(pr$time, rollmean(pr$slot, 600, fill=list(NA, NULL, NA)), col=alpha(col_pr[2], 0.5))
sync <- lines(tk$time, rollmean(tk$slot, 600, fill=list(NA, NULL, NA)), col=alpha(col_tk[2], 0.5))
sync <- text(6500, 180000, "1h 48min 59sec", cex=0.8, pos=4, col=col_lh[1])
sync <- text(30000, 170000, "8h 48min 8sec", cex=0.8, pos=4, col=col_tk[1])
sync <- text(70000, 160000, "23h 50min 3sec", cex=0.8, pos=4, col=col_pr[1])
sync <- text(70000, 20000, "--- Lighthouse", cex=0.8, pos=4, col=col_lh[2])
sync <- text(70000, 12000, "--- Teku", cex=0.8, pos=4, col=col_tk[2])
sync <- text(70000, 4000, "--- Prysm", cex=0.8, pos=4, col=col_pr[2])

dbt <- plot(pr$time, pr$db, main="Database Size", xlab="Time [s]", ylab="Database Size [B]", log="y", ylim=c(50000000,10000000000), pch=".", col=alpha(col_pr[3], 0.3))
dbt <- lines(tk$time, tk$db, type="p", pch=".", col=alpha(col_tk[3], 0.3))
dbt <- lines(lh$time, lh$db, type="p", pch=".", col=alpha(col_lh[3], 0.3))
dbt <- lines(lh$time, rollmean(lh$db, 600, fill=list(NA, NULL, NA)), col=alpha(col_lh[2], 0.5))
dbt <- lines(pr$time, rollmean(pr$db, 600, fill=list(NA, NULL, NA)), col=alpha(col_pr[2], 0.5))
dbt <- lines(tk$time, rollmean(tk$db, 600, fill=list(NA, NULL, NA)), col=alpha(col_tk[2], 0.5))
dbt <- text(70000, 100000000, "--- Prysm", cex=0.8, pos=4, col=col_pr[2])
dbt <- text(70000, 84000000, "--- Teku", cex=0.8, pos=4, col=col_tk[2])
dbt <- text(70000, 71000000, "--- Lighthouse", cex=0.8, pos=4, col=col_lh[2])

mem <- plot(pr$time, pr$mem, main="Resident Memory", xlab="Time [s]", ylab="Memory Usage [B]", log="y", ylim=c(50000000,10000000000), pch=".", col=alpha(col_pr[3], 0.3))
mem <- lines(tk$time, tk$mem, type="p", pch=".", col=alpha(col_tk[3], 0.3))
mem <- lines(lh$time, lh$mem, type="p", pch=".", col=alpha(col_lh[3], 0.3))
mem <- lines(lh$time, rollmean(lh$mem, 600, fill=list(NA, NULL, NA)), col=alpha(col_lh[2], 0.5))
mem <- lines(pr$time, rollmean(pr$mem, 600, fill=list(NA, NULL, NA)), col=alpha(col_pr[2], 0.5))
mem <- lines(tk$time, rollmean(tk$mem, 600, fill=list(NA, NULL, NA)), col=alpha(col_tk[2], 0.5))
mem <- text(70000, 100000000, "--- Prysm", cex=0.8, pos=4, col=col_pr[2])
mem <- text(70000, 84000000, "--- Teku", cex=0.8, pos=4, col=col_tk[2])
mem <- text(70000, 71000000, "--- Lighthouse", cex=0.8, pos=4, col=col_lh[2])

prs <- plot(lh$time, lh$peers, main="P2P Peer Count", xlab="Time [s]", ylab="Peer Count [1]", pch=".", col=alpha(col_lh[3], 0.3))
prs <- lines(pr$time, pr$peers, type="p", pch=".", col=alpha(col_pr[3], 0.3))
prs <- lines(tk$time, tk$peers, type="p", pch=".", col=alpha(col_tk[3], 0.3))
prs <- lines(lh$time, rollmean(lh$peers, 600, fill=list(NA, NULL, NA)), col=alpha(col_lh[2], 0.5))
prs <- lines(pr$time, rollmean(pr$peers, 600, fill=list(NA, NULL, NA)), col=alpha(col_pr[2], 0.5))
prs <- lines(tk$time, rollmean(tk$peers, 600, fill=list(NA, NULL, NA)), col=alpha(col_tk[2], 0.5))
prs <- text(70000, 10, "--- Lighthouse", cex=0.8, pos=4, col=col_lh[2])
prs <- text(70000, 8, "--- Prysm", cex=0.8, pos=4, col=col_pr[2])
prs <- text(70000, 6, "--- Teku", cex=0.8, pos=4, col=col_tk[2])

bps <- plot(lh$time, lh$bps_avg, main="Synchronization Speed", xlab="Time [s]", ylab="Slots per Second [1/s]", log="y", pch=".", col=alpha(col_lh[3], 0.3))
bps <- lines(pr$time, pr$bps_avg, type="p", pch=".", col=alpha(col_pr[3], 0.3))
bps <- lines(tk$time, tk$bps_avg, type="p", pch=".", col=alpha(col_tk[3], 0.3))
bps <- lines(lh$time, rollmean(lh$bps_avg, 600, fill=list(NA, NULL, NA)), col=alpha(col_lh[2], 0.5))
bps <- lines(pr$time, rollmean(pr$bps_avg, 600, fill=list(NA, NULL, NA)), col=alpha(col_pr[2], 0.5))
bps <- lines(tk$time, rollmean(tk$bps_avg, 600, fill=list(NA, NULL, NA)), col=alpha(col_tk[2], 0.5))
bps <- text(6500, 31, "29.127/s", cex=0.8, pos=4, col=col_lh[1])
bps <- text(31000, 7, "6.0767/s", cex=0.8, pos=4, col=col_tk[1])
bps <- text(78000, 3, "2.2953/s", cex=0.8, pos=4, col=col_pr[1])
bps <- text(70000, 50, "--- Lighthouse", cex=0.8, pos=4, col=col_lh[2])
bps <- text(70000, 43, "--- Teku", cex=0.8, pos=4, col=col_tk[2])
bps <- text(70000, 37, "--- Prysm", cex=0.8, pos=4, col=col_pr[2])

fin <- plot(lh$time, lh$bps_avg, main="The Final Chart", xlab="Time [s]", ylab="Blocks per Second [1/s]", log="y", ylim=c(1, 5000), pch=".", col=alpha(col_lh[3], 0.3))
fin <- lines(pr$time, pr$bps_avg, type="p", pch=".", col=alpha(col_pr[3], 0.3))
fin <- lines(tk$time, tk$bps_avg, type="p", pch=".", col=alpha(col_tk[3], 0.3))
fin <- lines(oe$time[1:60], oe$bps[1:60], type="p", pch=".", col=alpha(col_oe[3], 0.3))
fin <- lines(lh$time, rollmean(lh$bps_avg, 600, fill=list(NA, NULL, NA)), col=alpha(col_lh[2], 0.5))
fin <- lines(pr$time, rollmean(pr$bps_avg, 600, fill=list(NA, NULL, NA)), col=alpha(col_pr[2], 0.5))
fin <- lines(tk$time, rollmean(tk$bps_avg, 600, fill=list(NA, NULL, NA)), col=alpha(col_tk[2], 0.5))
fin <- lines(oe$time[1:60], rollmean(oe$bps[1:60], 120, fill=list(NA, NULL, NA)), col=alpha(col_oe[2], 0.5))
fin <- text(300, 1500, "1027.0/s", cex=0.8, pos=4, col=col_oe[1])
fin <- text(6500, 31, "29.127/s", cex=0.8, pos=4, col=col_lh[1])
fin <- text(31000, 7, "6.0767/s", cex=0.8, pos=4, col=col_tk[1])
fin <- text(78000, 3, "2.2953/s", cex=0.8, pos=4, col=col_pr[1])
fin <- text(55000, 2000, "--- OpenEthereum (ETH1)", cex=0.8, pos=4, col=col_oe[2])
fin <- text(55000, 1150, "--- Lighthouse (ETH2)", cex=0.8, pos=4, col=col_lh[2])
fin <- text(55000, 890, "--- Teku (ETH2)", cex=0.8, pos=4, col=col_tk[2])
fin <- text(55000, 700, "--- Prysm (ETH2)", cex=0.8, pos=4, col=col_pr[2])
